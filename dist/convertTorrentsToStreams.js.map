{"version":3,"sources":["../src/convertTorrentsToStreams.js"],"names":["MIN_SEEDERS","STREAMS_PER_CATEGORY","makeDetailsString","prefix","args","string","filter","arg","i","indexOf","join","undefined","isEligibleTorrent","torrent","torrentsByCategory","category","seeders","languages","length","includes","torrentToStream","magnetLink","audio","infoHash","name","magnet","decode","resolution","quality","videoDetails","audioDetails","seedersDetails","tag","title","v","availability","convertTorrentsToStreams","torrents","map"],"mappings":";;;;;;;AAAA;;AACA;;;;AAGA,MAAMA,cAAc,CAApB;AACA,MAAMC,uBAAuB,CAA7B;;AAGA,SAASC,iBAAT,CAA2BC,MAA3B,EAAmC,GAAGC,IAAtC,EAA4C;AAC1C,MAAIC,SAASD,KACVE,MADU,CACH,CAACC,GAAD,EAAMC,CAAN,KAAYD,OAAOH,KAAKK,OAAL,CAAaF,GAAb,MAAsBC,CADtC,EAEVE,IAFU,CAEL,GAFK,CAAb;AAGA,SAAOL,SAAU,GAAEF,MAAO,IAAGE,MAAO,EAA7B,GAAiCM,SAAxC;AACD;;AAED,SAASC,iBAAT,CAA2BC,OAA3B,EAAoCC,kBAApC,EAAwD;AACtD,MAAI;AAAEC,YAAF;AAAYC,cAAU,CAAtB;AAAyBC,gBAAY;AAArC,MAA4CJ,OAAhD,CADsD,CAGtD;;AACA,MAAIG,UAAUhB,WAAV,IACFiB,UAAUC,MAAV,IAAoB,CAACD,UAAUE,QAAV,CAAmB,IAAnB,CADvB,EAEG;AACD,WAAO,KAAP;AACD;;AAEDL,qBAAmBC,QAAnB,IAA+BD,mBAAmBC,QAAnB,KAAgC,CAA/D;AACAD,qBAAmBC,QAAnB;AACA,SAAOD,mBAAmBC,QAAnB,KAAgCd,oBAAvC;AACD;;AAED,SAASmB,eAAT,CAAyBP,OAAzB,EAAkC;AAChC,MAAI;AAAEQ,cAAF;AAAcN,YAAd;AAAwBC,WAAxB;AAAiCM,SAAjC;AAAwCL,gBAAY;AAApD,MAA2DJ,OAA/D;;AACA,MAAI;AAAEU,YAAF;AAAYC;AAAZ,MAAqBC,mBAAOC,MAAP,CAAcL,UAAd,CAAzB;;AACA,MAAI;AAAEM,cAAF;AAAcC;AAAd,MAA0B,gCAAiBJ,IAAjB,CAA9B;AACA,MAAIK,eAAe3B,kBAAkB,IAAlB,EAAwBa,QAAxB,EAAkCY,UAAlC,EAA8CC,OAA9C,CAAnB;AACA,MAAIE,eAAe5B,kBAAkB,IAAlB,EAAwBoB,KAAxB,EAA+B,GAAGL,SAAlC,CAAnB;AACA,MAAIc,iBAAiB7B,kBAAkB,IAAlB,EAAwBc,OAAxB,CAArB;AACA,MAAIgB,MAAML,aAAa,CAACA,UAAD,CAAb,GAA4BhB,SAAtC;AACA,MAAIsB,QAAQ,CAACJ,YAAD,EAAeC,YAAf,EAA6BC,cAA7B,EACTzB,MADS,CACD4B,CAAD,IAAOA,CADL,EAETxB,IAFS,CAEJ,IAFI,CAAZ,CARgC,CAUlB;;AACd,MAAIyB,eAAe,CAAnB;;AAEA,MAAInB,WAAW,EAAf,EAAmB;AACjBmB,mBAAe,CAAf;AACD,GAFD,MAEO,IAAInB,WAAW,EAAf,EAAmB;AACxBmB,mBAAe,CAAf;AACD,GAFM,MAEA,IAAInB,OAAJ,EAAa;AAClBmB,mBAAe,CAAf;AACD;;AAED,SAAO;AAAEH,OAAF;AAAOG,gBAAP;AAAqBF,SAArB;AAA4BV;AAA5B,GAAP;AACD;;AAED,SAASa,wBAAT,CAAkCC,QAAlC,EAA4C;AAC1C,MAAIvB,qBAAqB,EAAzB;AACA,SAAOuB,SACJ/B,MADI,CACIO,OAAD,IAAaD,kBAAkBC,OAAlB,EAA2BC,kBAA3B,CADhB,EAEJwB,GAFI,CAEAlB,eAFA,CAAP;AAGD;;eAGcgB,wB","sourcesContent":["import magnet from 'magnet-uri'\nimport parseTorrentName from 'torrent-name-parser'\n\n\nconst MIN_SEEDERS = 0\nconst STREAMS_PER_CATEGORY = 2\n\n\nfunction makeDetailsString(prefix, ...args) {\n  let string = args\n    .filter((arg, i) => arg && args.indexOf(arg) === i)\n    .join(' ')\n  return string ? `${prefix} ${string}` : undefined\n}\n\nfunction isEligibleTorrent(torrent, torrentsByCategory) {\n  let { category, seeders = 0, languages = [] } = torrent\n\n  // When languages are specified and there is no English, ignore the torrent\n  if (seeders < MIN_SEEDERS || (\n    languages.length && !languages.includes('EN')\n  )) {\n    return false\n  }\n\n  torrentsByCategory[category] = torrentsByCategory[category] || 0\n  torrentsByCategory[category]++\n  return torrentsByCategory[category] <= STREAMS_PER_CATEGORY\n}\n\nfunction torrentToStream(torrent) {\n  let { magnetLink, category, seeders, audio, languages = [] } = torrent\n  let { infoHash, name } = magnet.decode(magnetLink)\n  let { resolution, quality } = parseTorrentName(name)\n  let videoDetails = makeDetailsString('ðŸ“º', category, resolution, quality)\n  let audioDetails = makeDetailsString('ðŸ”‰', audio, ...languages)\n  let seedersDetails = makeDetailsString('ðŸ‘¤', seeders)\n  let tag = resolution ? [resolution] : undefined\n  let title = [videoDetails, audioDetails, seedersDetails]\n    .filter((v) => v)\n    .join(', ') // The Stremio app seems to replace commas with line breaks\n  let availability = 0\n\n  if (seeders >= 50) {\n    availability = 3\n  } else if (seeders >= 20) {\n    availability = 2\n  } else if (seeders) {\n    availability = 1\n  }\n\n  return { tag, availability, title, infoHash }\n}\n\nfunction convertTorrentsToStreams(torrents) {\n  let torrentsByCategory = {}\n  return torrents\n    .filter((torrent) => isEligibleTorrent(torrent, torrentsByCategory))\n    .map(torrentToStream)\n}\n\n\nexport default convertTorrentsToStreams\n"],"file":"convertTorrentsToStreams.js"}