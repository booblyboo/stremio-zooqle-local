{"version":3,"sources":["../src/index.js"],"names":["STATIC_DIR","USER_AGENT","ID_PROPERTY","atob","str","Buffer","from","toString","ID","ENDPOINT","PROXY","CACHE","EMAIL","USERNAME","config","username","PASSWORD","password","MANIFEST","name","id","version","pkg","description","types","idPrefixes","resources","email","contactEmail","logo","icon","background","catalogs","builder","addonBuilder","findStreams","args","imdbId","reject","Error","torrents","type","client","getMovieTorrents","season","split","episode","getShowTorrents","defineStreamHandler","Promise","resolve","then","streams","length","cacheMaxAge","catch","err","console","error","Date","toLocaleString","ZooqleClient","userName","userAgent","proxy","cache","module","exports","getInterface"],"mappings":"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","sourcesContent":["import { addonBuilder, serveHTTP, publishToCentral, getRouter } from 'stremio-addon-sdk'\nimport pkg from '../package.json'\nimport ZooqleClient from './ZooqleClient'\nimport convertTorrentsToStreams from './convertTorrentsToStreams'\n\nimport { config } from 'internal'\n\nconst STATIC_DIR = 'static'\nconst USER_AGENT = 'stremio-zooqle'\nconst ID_PROPERTY = 'tt'\n\nfunction atob(str) { return Buffer.from(str, 'base64').toString('binary') }\n\nconst ID = 'stremio_zooqle_plus'\nconst ENDPOINT = 'https://stremio-zooqle.now.sh'\nconst PROXY = false\nconst CACHE = '1'\nconst EMAIL = ''\nconst USERNAME = config.username || atob('Ym9vYmx5Ym9v')\nconst PASSWORD = config.password || atob('Ym9vYmx5Ym9vMTAxIQ==')\n\nconst MANIFEST = {\n  name: 'Zooqle+',\n  id: ID,\n  version: pkg.version,\n  description: '\\\nWatch movies and series indexed by Zooqle from RARBG, KAT, YTS, MegaTorrents and other torrent trackers\\\n',\n  types: ['movie', 'series'],\n  idPrefixes: [ ID_PROPERTY ],\n  resources: [ 'stream' ],\n  // The docs mention `contactEmail`, but the template uses `email`\n  email: EMAIL,\n  contactEmail: EMAIL,\n  logo: `${ENDPOINT}/logo-white.png`,\n  icon: `${ENDPOINT}/logo-white.png`,\n  background: `${ENDPOINT}/bg.jpg`,\n  catalogs: []\n}\n\nconst builder = new addonBuilder(MANIFEST)\n\nasync function findStreams(args) {\n  let imdbId = args.id\n\n  if (!imdbId) {\n    reject(Error('No IMDB ID in stream request'))\n    return\n  }\n\n  let torrents\n\n  if (args.type === 'movie') {\n    torrents = await client.getMovieTorrents(imdbId)\n  } else {\n    const season = imdbId.split(':')[1]\n    const episode = imdbId.split(':')[2]\n    imdbId = imdbId.split(':')[0]\n    torrents = await client.getShowTorrents(imdbId, season, episode)\n  }\n\n  return convertTorrentsToStreams(torrents)\n\n}\n\nbuilder.defineStreamHandler(args => {\n  return new Promise(async (resolve, reject) => {\n    findStreams(args).then(streams => {\n      if ((streams || []).length)\n        resolve({ streams, cacheMaxAge: 172800 }) // two days\n      else\n        reject({ streams: [], cacheMaxAge: 3600 }) // one hour\n    }).catch(err => {\n      /* eslint-disable no-console */\n      console.error(\n        // eslint-disable-next-line prefer-template\n        (new Date().toLocaleString()) +\n        ' An error has occurred while processing the following request:'\n      )\n      console.error(args)\n      console.error(err)\n      /* eslint-enable no-console */\n      reject(err)\n    })\n\n  })\n\n})\n\nlet client = new ZooqleClient({\n  userName: USERNAME,\n  password: PASSWORD,\n  userAgent: USER_AGENT,\n  proxy: PROXY,\n  cache: CACHE,\n})\n\nmodule.exports = getRouter(builder.getInterface())\n"],"file":"index.js"}
